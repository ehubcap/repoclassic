<?xml version="1.0" encoding="utf-8"?>

<!-- For more information on using web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  <system.web>
    <compilation xdt:Transform="RemoveAttributes(debug)" />
  </system.web>
  <system.webServer xdt:Transform="InsertIfMissing">
    <rewrite xdt:Transform="InsertIfMissing">
      <rules xdt:Transform="InsertIfMissing">
        <rule name="Block unauthorized traffic to staging" xdt:Locator="Match(name)" patternSyntax="Wildcard" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url=".*"/>
          <conditions>
            <!--Enter your staging site host name here as the pattern-->
            <add input="{HTTP_HOST}" pattern="^ehubcap\-staging\."/>
            <!--Enter your white listed IP addresses-->
            <add input="{REMOTE_ADDR}" pattern="172\.16\.5\.1" negate="true"/>
            <add input="{REMOTE_ADDR}" pattern="75\.145\.78\.198" negate="true"/>
          </conditions>
          <action type="CustomResponse" statusCode="403" statusReason="Forbidden" statusDescription="Site is not accessible"/>
        </rule>
        <rule name="Block traffic to the raw azurewebsites url" xdt:Locator="Match(name)" patternSyntax="Wildcard" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="*" />
          <conditions>
            <add input="{HTTP_HOST}" pattern="*azurewebsites.net*" />
          </conditions>
          <action type="CustomResponse" statusCode="403" statusReason="Forbidden"
          statusDescription="Site is not accessible" />
        </rule>        
        <!--<rule name="redirect-plugins" xdt:Locator="Match(name)" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="Plugins/(.*)" ignoreCase="true" />
          <action type="Redirect" url="http://st2.ehubcap.net/plugins/{R:1}" redirectType="Permanent" appendQueryString="true" logRewrittenUrl="true" />
        </rule>-->
        <!--<rule name="redirect-scripts" xdt:Locator="Match(name)" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="Scripts/(.*)$" ignoreCase="true" />
          <action type="Redirect" url="http://st2.ehubcap.net/scripts/{R:1}" redirectType="Permanent" appendQueryString="true" logRewrittenUrl="true" />
        </rule>-->
        <rule name="redirect-images" xdt:Locator="Match(name)" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="^Content/Images/(.*)" ignoreCase="true"/>
          <action type="Redirect" url="http://st2.ehubcap.net/content/images/{R:1}" redirectType="Permanent" appendQueryString="true" logRewrittenUrl="true"/>
        </rule>
        <rule name="redirect-img" xdt:Locator="Match(name)" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="^themes/traction/content/img/(.*)" ignoreCase="true"/>
          <action type="Redirect" url="http://st2.ehubcap.net/themes/traction/content/img/{R:1}" redirectType="Permanent" appendQueryString="true" logRewrittenUrl="true"/>
        </rule>
        <rule name="redirect-css" xdt:Locator="Match(name)" stopProcessing="true" xdt:Transform="InsertIfMissing">
          <match url="css/(.*)$" ignoreCase="true"/>
          <action type="Redirect" url="http://st2.ehubcap.net/themes/traction/content/css/{R:1}" redirectType="Permanent" appendQueryString="true" logRewrittenUrl="true"/>
        </rule>
    </rules>
  </rewrite>
</system.webServer> 
</configuration>